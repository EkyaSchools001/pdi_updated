<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Workflow & Project Architecture Diagrams</title>
    <!-- Github Style CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <style>
        body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }
        @media (max-width: 767px) {
            body {
                padding: 15px;
            }
        }
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }
    </style>
</head>
<body class="markdown-body">

<h1>n8n Workflow & Project Architecture Diagrams</h1>

<p>This document visualizes the automation workflows and internal project logic using <strong>Mermaid</strong> diagrams.</p>

<hr>

<h2>Part 1: n8n Automation Workflows</h2>
<p><em>These diagrams represent the node-based flow you should build in n8n. Each box represents a Node.</em></p>

<h3>1. User Onboarding & Sync</h3>
<p><strong>Goal</strong>: Sync employees from HR System (e.g., Darwinbox) to School Growth Hub automatically.</p>
<pre class="mermaid">
graph LR
    %% Styles
    classDef trigger fill:#ff6d5a,stroke:#333,stroke-width:2px,color:white;
    classDef action fill:#40a9ff,stroke:#333,stroke-width:2px,color:white;
    classDef logic fill:#ffc107,stroke:#333,stroke-width:2px,color:black;

    Start((Trigger: Daily/Webhook)):::trigger --> FetchHR[HTTP: Fetch HR Data]:::action
    FetchHR --> Split[Split In Batches]:::logic
    Split --> Check{User Exists?}:::logic
    Check -- No --> Create[HTTP POST: Create User]:::action
    Check -- Yes --> Update[HTTP PATCH: Update User]:::action
    Create --> Email[Email: Send Login Details]:::action
    Update --> Next[Next Item]:::logic
    Email --> Next
</pre>

<h3>2. Observation Feedback Loop</h3>
<p><strong>Goal</strong>: Notify teachers immediately upon submission of an observation.</p>
<pre class="mermaid">
graph LR
    classDef trigger fill:#ff6d5a,stroke:#333,stroke-width:2px,color:white;
    classDef action fill:#40a9ff,stroke:#333,stroke-width:2px,color:white;
    classDef slack fill:#4A154B,stroke:#333,stroke-width:2px,color:white;

    Webhook((Webhook: Observation Submitted)):::trigger --> Lookup[Postgres: Get Teacher Details]:::action
    Lookup --> Format[Function: Create Message]:::action
    Format --> Notify{Channel?}:::logic
    Notify -- Slack --> SlackNode[Slack: Send Message]:::slack
    Notify -- Email --> EmailNode[Email: Send Summary]:::action
</pre>

<h3>3. Weekly Leadership Reports</h3>
<p><strong>Goal</strong>: Email statistics summary to leaders every Monday morning.</p>
<pre class="mermaid">
graph LR
    classDef trigger fill:#ff6d5a,stroke:#333,stroke-width:2px,color:white;
    classDef action fill:#40a9ff,stroke:#333,stroke-width:2px,color:white;

    Cron((Cron: Monday 8AM)):::trigger --> FetchStats[HTTP GET: /stats/weekly]:::action
    FetchStats --> GenPDF[HTML to PDF: Create Report]:::action
    GenPDF --> GetLeaders[Postgres: Get All Leaders]:::action
    GetLeaders --> Split[Split Batches]:::logic
    Split --> SendEmail[Email: Send PDF Attachment]:::action
    SendEmail --> Split
</pre>

<h3>4. Training Session Reminders</h3>
<p><strong>Goal</strong>: Remind attendees 24 hours before a training event.</p>
<pre class="mermaid">
graph LR
    classDef trigger fill:#ff6d5a,stroke:#333,stroke-width:2px,color:white;
    classDef action fill:#40a9ff,stroke:#333,stroke-width:2px,color:white;

    Cron((Cron: Daily 9AM)):::trigger --> GetEvents[HTTP GET: Tomorrow's Events]:::action
    GetEvents --> LoopEvents[Split: For Each Event]:::logic
    LoopEvents --> GetAttendees[Postgres: Get Participants]:::action
    GetAttendees --> LoopUsers[Split: For Each User]:::logic
    LoopUsers --> SendRem[Email: Send Reminder]:::action
    SendRem --> LoopUsers
</pre>

<h3>5. Document Expiry Alerts</h3>
<p><strong>Goal</strong>: Alert users when their uploaded certifications are about to expire.</p>
<pre class="mermaid">
graph LR
    classDef trigger fill:#ff6d5a,stroke:#333,stroke-width:2px,color:white;
    classDef action fill:#40a9ff,stroke:#333,stroke-width:2px,color:white;

    Trigger((Cron: Daily)):::trigger --> DBQuery[Postgres: Query Expiring Docs]:::action
    DBQuery --> Split[Split In Batches]:::logic
    Split --> SendAlert[Email: Send Renewal Alert]:::action
    SendAlert --> Split
</pre>

<hr>

<h2>Part 2: Project Module Flows (Sequence Diagrams)</h2>
<p><em>These diagrams show the interaction between Users, the Frontend, and the Backend logic.</em></p>

<h3>1. Observation Process Flow</h3>
<p><strong>Actors</strong>: Leader (Observer), Teacher (Observee)</p>
<pre class="mermaid">
sequenceDiagram
    participant Leader
    participant Frontend
    participant Backend
    participant DB
    participant n8n

    Leader->>Frontend: Selects Teacher & Template
    Frontend->>Backend: GET /templates
    Backend-->>Frontend: Returns Form Template
    Leader->>Frontend: Fills Scores & Notes
    Leader->>Frontend: Clicks "Submit"
    Frontend->>Backend: POST /observations
    Backend->>DB: Save Observation
    Backend->>n8n: Trigger Webhook (Async)
    n8n->>Teacher: Send Notification (Email/Slack)
    Backend-->>Frontend: Success Response
    Frontend-->>Leader: Show Success Message
    Note over Teacher: Teacher logs in later
    Teacher->>Frontend: Views Observation
    Teacher->>Backend: POST /observations/:id/reflection
</pre>

<h3>2. Professional Development (PD) Goals Flow</h3>
<p><strong>Actors</strong>: Teacher, Leader</p>
<pre class="mermaid">
sequenceDiagram
    participant Teacher
    participant Backend
    participant Leader

    Teacher->>Backend: POST /goals (Create Goal)
    Note right of Backend: Goal Status: "Pending Approval"
    Leader->>Backend: GET /goals (View Team Goals)
    Leader->>Backend: PATCH /goals/:id/approve
    Note right of Backend: Goal Status: "In Progress"
    Teacher->>Backend: PATCH /goals/:id/progress (Update %)
    Teacher->>Backend: PATCH /goals/:id/complete
    Note right of Backend: Goal Status: "Completed"
</pre>

<h3>3. Training Event Registration Flow</h3>
<p><strong>Actors</strong>: Admin, Teacher</p>
<pre class="mermaid">
sequenceDiagram
    participant Admin
    participant Backend
    participant Teacher

    Admin->>Backend: POST /trainings (Create Event)
    Teacher->>Backend: GET /trainings (View Calendar)
    Teacher->>Backend: POST /trainings/:id/register
    Note right of Backend: Check Capacity & Conflicts
    Backend-->>Teacher: Registration Confirmed
    Note over Backend: Day of Event
    Admin->>Backend: POST /attendance (Mark Present)
    Backend->>Backend: Add PD Hours to Teacher Profile
</pre>

<h3>4. Document Management & Acknowledgement</h3>
<p><strong>Actors</strong>: Admin, Teacher</p>
<pre class="mermaid">
sequenceDiagram
    participant Admin
    participant S3_Storage
    participant Backend
    participant Teacher

    Admin->>Backend: Upload Policy Document
    Backend->>S3_Storage: Store File
    Backend->>Backend: Create Document Record (Req. Ack = True)
    Teacher->>Backend: GET /documents
    Backend-->>Teacher: List (Shows "Pending Action")
    Teacher->>Backend: GET /documents/:id/download
    Teacher->>Backend: POST /documents/:id/acknowledge
    Backend->>Backend: Record Timestamp & UserID
</pre>

    <!-- Load Mermaid -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>
