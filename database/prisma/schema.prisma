generator client {
  provider = "prisma-client-js"
  output   = "../../backend/node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                           String                        @id @default(uuid())
  email                        String                        @unique
  passwordHash                 String?                       @default("")
  fullName                     String
  profilePicture               String?
  role                         String                        @default("TEACHER")
  campusId                     String?
  department                   String?
  status                       String                        @default("Active")
  lastActive                   DateTime?
  lastSeen                     DateTime?
  isVerified                   Boolean                       @default(false)
  campusAccess                 String?
  dateOfBirth                  String?
  managerId                    String?
  academics                    AcademicType?                 @default(CORE)
  createdAt                    DateTime                      @default(now())
  updatedAt                    DateTime                      @updatedAt
  createdAnnouncements         Announcement[]                @relation("AnnouncementCreator")
  announcementAcknowledgements AnnouncementAcknowledgement[]
  createdAssessments           Assessment[]
  assignedByMe                 AssessmentAssignment[]        @relation("AssignedBy")
  assessmentAssignments        AssessmentAssignment[]        @relation("AssignedTo")
  assessmentAttempts           AssessmentAttempt[]
  enrollments                  CourseEnrollment[]
  createdDocuments             Document[]
  acknowledgements             DocumentAcknowledgement[]
  attendanceRecords            EventAttendance[]
  goals                        Goal[]
  reviewedApplications         LearningFestivalApplication[] @relation("ApplicationReviewer")
  festivalApplications         LearningFestivalApplication[] @relation("Applicant")
  createdMeetings              Meeting[]                     @relation("MeetingCreator")
  meetingAttendees             MeetingAttendee[]
  momCreated                   MeetingMinutes[]              @relation("MoMCreator")
  meetingReplies               MeetingReply[]
  moocSubmissions              MoocSubmission[]
  notifications                Notification[]
  sentObservations             Observation[]                 @relation("Observer")
  receivedObservations         Observation[]                 @relation("Teacher")
  pdHours                      PDHour[]
  registrations                Registration[]
  createdEvents                TrainingEvent[]               @relation("CreatedEvents")
  proposedEvents               TrainingEvent[]               @relation("ProposedEvents")
  trainingFeedbacks            TrainingFeedback[]
  postOrientationAssessments   PostOrientationAssessment[]
  surveyResponses              SurveyResponse[]
  growthObservationsSent       GrowthObservation[]           @relation("GrowthObserver")
  growthObservationsReceived   GrowthObservation[]           @relation("GrowthTeacher")

  @@index([academics])
}

model Meeting {
  id           String              @id @default(uuid())
  title        String
  description  String?
  meetingType  String
  campusId     String?
  departmentId String?
  meetingDate  String
  startTime    String
  endTime      String
  mode         String
  locationLink String?
  createdById  String
  status       String              @default("Draft")
  momStatus    String              @default("Not Created")
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  createdBy    User                @relation("MeetingCreator", fields: [createdById], references: [id])
  actionItems  MeetingActionItem[]
  attendees    MeetingAttendee[]
  minutes      MeetingMinutes?
  replies      MeetingReply[]
  shares       MeetingShare[]
}

model MeetingAttendee {
  id               String  @id @default(uuid())
  meetingId        String
  userId           String
  attendanceStatus String  @default("Invited")
  user             User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  meeting          Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)

  @@unique([meetingId, userId])
}

model MeetingMinutes {
  id                String   @id @default(uuid())
  meetingId         String   @unique
  objective         String
  agendaPoints      String
  discussionSummary String
  decisions         String
  attendanceCount   Int      @default(0)
  attendanceSummary String?
  departments       String?
  attachments       String?
  status            String   @default("Draft")
  createdById       String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         User     @relation("MoMCreator", fields: [createdById], references: [id])
  meeting           Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model MeetingActionItem {
  id              String   @id @default(uuid())
  meetingId       String
  taskDescription String
  assignedTo      String
  deadline        String
  priority        String   @default("Medium")
  status          String   @default("Pending")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  meeting         Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model MeetingReply {
  id        String   @id @default(uuid())
  meetingId String
  userId    String
  replyText String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  meeting   Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model MeetingShare {
  id             String   @id @default(uuid())
  meetingId      String
  sharedBy       String
  targetRole     String
  targetCampusId String?
  sharedAt       DateTime @default(now())
  meeting        Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model Observation {
  id                 String              @id @default(uuid())
  teacherId          String
  observerId         String
  date               String
  domain             String
  score              Float
  notes              String?
  status             String              @default("SUBMITTED")
  actionStep         String?
  teacherReflection  String?
  detailedReflection String?
  discussionMet      Boolean             @default(false)
  hasReflection      Boolean             @default(false)
  campus             String?
  block              String?
  grade              String?
  section            String?
  learningArea       String?
  type               String?
  strengths          String?
  areasOfGrowth      String?
  otherComment       String?
  metaTags           String?
  tools              String?
  routines           String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  observer           User                @relation("Observer", fields: [observerId], references: [id])
  teacher            User                @relation("Teacher", fields: [teacherId], references: [id])
  domainRatings      ObservationDomain[]
}

model ObservationDomain {
  id            String      @id @default(uuid())
  observationId String
  domainId      String
  title         String
  rating        String
  evidence      String?
  observation   Observation @relation(fields: [observationId], references: [id], onDelete: Cascade)
}

model Goal {
  id                        String    @id @default(uuid())
  teacherId                 String
  teacherEmail              String?
  title                     String
  description               String?
  progress                  Int       @default(0)
  dueDate                   String
  status                    String    @default("IN_PROGRESS")
  isSchoolAligned           Boolean   @default(false)
  category                  String?
  assignedBy                String?
  actionStep                String?
  campus                    String?
  selfReflectionForm        String?
  goalSettingForm           String?
  goalCompletionForm        String?
  selfReflectionCompletedAt DateTime?
  goalSettingCompletedAt    DateTime?
  goalCompletionCompletedAt DateTime?
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
  teacher                   User      @relation(fields: [teacherId], references: [id])
}

model TrainingEvent {
  id                    String             @id @default(uuid())
  title                 String
  topic                 String
  type                  String
  date                  String
  location              String
  capacity              Int
  status                String             @default("PLANNED")
  time                  String?
  description           String?
  objectives            String?
  schoolId              String?
  createdById           String?
  attendanceEnabled     Boolean            @default(false)
  attendanceTriggeredAt DateTime?
  attendanceClosed      Boolean            @default(false)
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  proposedById          String?
  attendanceRecords     EventAttendance[]
  registrations         Registration[]
  createdBy             User?              @relation("CreatedEvents", fields: [createdById], references: [id])
  proposedBy            User?              @relation("ProposedEvents", fields: [proposedById], references: [id])
  feedbacks             TrainingFeedback[]
}

model Registration {
  id               String        @id @default(uuid())
  eventId          String
  userId           String
  registrationDate DateTime      @default(now())
  user             User          @relation(fields: [userId], references: [id])
  event            TrainingEvent @relation(fields: [eventId], references: [id])

  @@unique([eventId, userId])
}

model EventAttendance {
  id           String        @id @default(uuid())
  eventId      String
  teacherId    String
  teacherName  String
  teacherEmail String
  mobile       String?
  employeeId   String?
  department   String?
  schoolId     String?
  submittedAt  DateTime      @default(now())
  status       Boolean       @default(true)
  teacher      User          @relation(fields: [teacherId], references: [id])
  event        TrainingEvent @relation(fields: [eventId], references: [id])

  @@unique([eventId, teacherEmail])
}

model TrainingFeedback {
  id        String        @id @default(uuid())
  eventId   String
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime      @default(now())
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     TrainingEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
}

model PDHour {
  id       String   @id @default(uuid())
  userId   String
  activity String
  hours    Float
  category String
  status   String   @default("APPROVED")
  date     DateTime @default(now())
  user     User     @relation(fields: [userId], references: [id])
}

model MoocSubmission {
  id                  String   @id @default(uuid())
  userId              String
  courseName          String
  platform            String
  otherPlatform       String?
  hours               Float
  startDate           DateTime
  endDate             DateTime
  hasCertificate      String
  certificateType     String?
  proofLink           String?
  certificateFile     String?
  certificateFileName String?
  keyTakeaways        String?
  unansweredQuestions String?
  enjoyedMost         String?
  effectivenessRating Int
  additionalFeedback  String?
  teacherName         String?
  teacherEmail        String?
  status              String   @default("PENDING")
  submittedAt         DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id])
}

model Document {
  id                String                    @id @default(uuid())
  title             String
  description       String?
  fileUrl           String
  fileName          String
  fileSize          Int?
  version           String                    @default("1.0")
  requiresSignature Boolean                   @default(false)
  createdById       String
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt
  hash              String?
  createdBy         User                      @relation(fields: [createdById], references: [id])
  acknowledgements  DocumentAcknowledgement[]
}

model DocumentAcknowledgement {
  id             String    @id @default(uuid())
  documentId     String
  teacherId      String
  status         String    @default("PENDING")
  viewedAt       DateTime?
  acknowledgedAt DateTime?
  signatureUrl   String?
  ipAddress      String?
  userAgent      String?
  receiptUrl     String?
  documentHash   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  teacher        User      @relation(fields: [teacherId], references: [id])
  document       Document  @relation(fields: [documentId], references: [id], onDelete: Cascade)
}

model Chat {
  id String @id @default(uuid())
}

model ChatParticipant {
  id String @id @default(uuid())
}

model MeetingRoom {
  id String @id @default(uuid())
}

model Message {
  id String @id @default(uuid())
}

model Project {
  id String @id @default(uuid())
}

model Task {
  id String @id @default(uuid())
}

model ProjectMembers {
  A String
  B String

  @@unique([A, B])
  @@map("_ProjectMembers")
}

model TaskAssignees {
  A String
  B String

  @@unique([A, B])
  @@map("_TaskAssignees")
}

model Course {
  id             String             @id @default(uuid())
  title          String
  category       String
  hours          Float
  instructor     String
  status         String             @default("Draft")
  description    String?
  thumbnail      String?
  url            String?
  isDownloadable Boolean            @default(false)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  enrollments    CourseEnrollment[]
}

model CourseEnrollment {
  id          String    @id @default(uuid())
  courseId    String
  userId      String
  status      String    @default("IN_PROGRESS")
  progress    Int       @default(0)
  completedAt DateTime?
  enrolledAt  DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id])
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
}

model SystemSettings {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

model DashboardLayout {
  id        String   @id @default(uuid())
  role      String   @unique
  layout    String   // JSON string containing layout configurations
  updatedBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FormTemplate {
  id        String   @id @default(uuid())
  name      String   @unique
  type      String
  structure String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workflows FormWorkflow[]
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String   @default("INFO")
  isRead    Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Announcement {
  id                String                        @id @default(uuid())
  title             String
  description       String
  createdById       String
  role              String
  priority          String                        @default("Normal")
  status            String                        @default("Published")
  isPinned          Boolean                       @default(false)
  targetRoles       String                        @default("[]")
  targetDepartments String?                       @default("[]")
  targetCampuses    String?                       @default("[]")
  expiryDate        DateTime?
  attachments       String?
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime                      @updatedAt
  createdBy         User                          @relation("AnnouncementCreator", fields: [createdById], references: [id])
  acknowledgements  AnnouncementAcknowledgement[]
}

model AnnouncementAcknowledgement {
  id             String       @id @default(uuid())
  announcementId String
  userId         String
  acknowledgedAt DateTime     @default(now())
  user           User         @relation(fields: [userId], references: [id])
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId])
}

model Survey {
  id           String           @id @default(uuid())
  title        String
  academicYear String           @map("academic_year")
  term         String
  description  String?
  isActive     Boolean          @default(true) @map("is_active")
  startDate    DateTime?        @map("start_date")
  endDate      DateTime?        @map("end_date")
  isAnonymous  Boolean          @default(true) @map("is_anonymous")
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  questions    SurveyQuestion[]
  responses    SurveyResponse[]

  @@map("surveys")
}

model SurveyQuestion {
  id           String         @id @default(uuid())
  surveyId     String         @map("survey_id")
  pageNumber   Int            @map("page_number")
  questionText String         @map("question_text")
  questionType String         @map("question_type")
  options      String?
  isRequired   Boolean        @default(true) @map("is_required")
  orderIndex   Int            @map("order_index")
  answers      SurveyAnswer[]
  survey       Survey         @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  @@map("survey_questions")
}

model SurveyResponse {
  id          String         @id @default(uuid())
  surveyId    String         @map("survey_id")
  userId      String         @map("user_id")
  campus      String?
  submittedAt DateTime       @default(now()) @map("submitted_at")
  isCompleted Boolean        @default(false) @map("is_completed")
  answers     SurveyAnswer[]
  user        User           @relation(fields: [userId], references: [id])
  survey      Survey         @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  @@map("survey_responses")
}

model SurveyAnswer {
  id            String         @id @default(uuid())
  responseId    String         @map("response_id")
  questionId    String         @map("question_id")
  answerText    String?        @map("answer_text")
  answerNumeric Float?         @map("answer_numeric")
  answerJson    String?        @map("answer_json")
  question      SurveyQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
  response      SurveyResponse @relation(fields: [responseId], references: [id], onDelete: Cascade)

  @@map("survey_answers")
}

model PostOrientationAssessment {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  campus       String?
  score        Float
  completed    Boolean  @default(false)
  term         String
  academicYear String   @map("academic_year")
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])

  @@map("post_orientation_assessments")
}

model LearningFestival {
  id                String                        @id @default(uuid())
  name              String
  theme             String
  description       String?
  startDate         DateTime
  endDate           DateTime
  registrationStart DateTime?
  registrationEnd   DateTime?                     @map("applyDeadline")
  location          String?
  duration          String?
  documents         String?
  sharedWithRoles   String?
  status            String                        @default("Draft")
  eligibilityRules  String?
  campusLimits      String?
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime                      @updatedAt
  applications      LearningFestivalApplication[]
}

model LearningFestivalApplication {
  id                 String           @id @default(uuid())
  festivalId         String
  userId             String
  statementOfPurpose String
  relevantExperience String?
  preferredStrand    String?
  status             String           @default("Draft")
  documents          String?
  feedback           String?
  appliedAt          DateTime?
  reviewedAt         DateTime?
  reviewedById       String?
  reviewer           User?            @relation("ApplicationReviewer", fields: [reviewedById], references: [id])
  user               User             @relation("Applicant", fields: [userId], references: [id], onDelete: Cascade)
  festival           LearningFestival @relation(fields: [festivalId], references: [id], onDelete: Cascade)
}

model Assessment {
  id               String                 @id @default(uuid())
  title            String
  description      String?
  type             String                 @default("CUSTOM")
  isTimed          Boolean                @default(false)
  timeLimitMinutes Int?
  maxAttempts      Int                    @default(1)
  createdById      String
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  createdBy        User                   @relation(fields: [createdById], references: [id])
  assignments      AssessmentAssignment[]
  attempts         AssessmentAttempt[]
  questions        AssessmentQuestion[]
}

model AssessmentQuestion {
  id            String     @id @default(uuid())
  assessmentId  String
  prompt        String
  type          String     @default("MCQ")
  options       String?
  correctAnswer String?
  points        Int        @default(1)
  assessment    Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
}

model AssessmentAssignment {
  id                 String     @id @default(uuid())
  assessmentId       String
  assignedToId       String?
  assignedToCampusId String?
  assignedToRole     String?
  assignedById       String
  assignedAt         DateTime   @default(now())
  assignedBy         User       @relation("AssignedBy", fields: [assignedById], references: [id])
  assignedTo         User?      @relation("AssignedTo", fields: [assignedToId], references: [id])
  assessment         Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
}

model AssessmentAttempt {
  id            String     @id @default(uuid())
  assessmentId  String
  userId        String
  startTime     DateTime   @default(now())
  endTime       DateTime?
  status        String     @default("IN_PROGRESS")
  attemptNumber Int        @default(1)
  score         Float?
  answers       String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  assessment    Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
}

enum AcademicType {
  CORE
  NON_CORE
}

enum GrowthModuleType {
  DANIELSON
  QUICK_FEEDBACK
  PERFORMING_ARTS
  LIFE_SKILLS
  PHYSICAL_EDUCATION
  VISUAL_ARTS
}

enum GrowthObservationStatus {
  SUBMITTED
  DRAFT
}

model GrowthObservation {
  id              String                  @id @default(uuid())
  teacherId       String
  observerId      String
  campusId        String?
  academicYear    String
  moduleType      GrowthModuleType
  subject         String?
  block           String?
  grade           String?
  section         String?
  observationDate DateTime                @default(now())
  overallRating   Float?                  @default(0)
  status          GrowthObservationStatus @default(DRAFT)
  formPayload     String? // Stringified JSON
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  teacher         User                    @relation("GrowthTeacher", fields: [teacherId], references: [id])
  observer        User                    @relation("GrowthObserver", fields: [observerId], references: [id])
}

model FormWorkflow {
  id               String   @id @default(uuid())
  formTemplateId   String
  subjectType      String?  // CORE, NON_CORE, ALL
  specificSubjects String?
  targetSchool     String?  @default("ALL")
  sentByRole       String   // e.g., Leader, Teacher, Admin
  redirectTo       String   // e.g., Teacher Dashboard, Admin Dashboard
  displayLocation  String   // e.g., Growth Reports, Pending Approvals
  logicDescription String?
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  formTemplate     FormTemplate @relation(fields: [formTemplateId], references: [id], onDelete: Cascade)
}

model AuditLog {
  id           String   @id @default(uuid())
  actorId      String?  
  actorName    String?  // Optional name snapshot purely for UI performance
  action       String   // e.g. 'UPDATED_WORKFLOWS', 'CREATED_TEMPLATE'
  targetEntity String   // e.g. 'FormWorkflow', 'SystemSettings'
  previousData String?  // JSON snapshot pre-change
  newData      String?  // JSON snapshot post-change
  timestamp    DateTime @default(now())
}

